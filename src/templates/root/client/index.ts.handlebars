---
to: "{{configuration.embraceSQLRoot}}/client/index.ts"
---
/* eslint-disable @typescript-eslint/camelcase */

import * as context from "./context";

{{> shared-client.ts}}

// Generation starts here

/**
* Create a  EmbraceSQL client.
*/
export const EmbraceSQL = (serverUrl: string) => {
  const DatabaseMap = {
  {{#eachInMap databases}}
    {{@key}}: {
    {{#treeAMap value.SQLModules database=@key}}
      {{#each value}}
      {{> moduleTree this database=@database}}
      {{/each}}
    {{/treeAMap}}
    },
  {{/eachInMap}}
  };
  return DatabaseMap;
};

{{#*inline "moduleTree"}}
{{name}}: {
  {{#if value}}
  sql: async () : Promise<context.{{value.contextName}}Results> => {
    {{#allSELECT value}}
    return get("/{{value.relativePath}}");
    {{else}}
    return post( "/{{value.relativePath}}");
    {{/allSELECT}}
  }
  {{/if}}
  {{#each children}}
    {{> moduleTree this database=database}}
  {{/each}}
}
{{/inline}}