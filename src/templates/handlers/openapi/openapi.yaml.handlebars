---
to: "{{module.fullPath}}.openapi.yaml"
---
/{{module.relativePath}}:
  {{#if module.allSELECT}}
    get:
      operationId: get__{{module.contextName}}
      produces:
        - "application/json"
      responses:
        '200':
          {{> resultset}}
  {{/if}}

{{#*inline "resultset"}}
content:
  application/json:
    schema:
      {{> resultsetMetadata}}
{{/inline}}

{{#*inline "resultsetMetadata"}}
{{#if module.multipleResultsets}}
type: object
{{> multipleResultsetMetadata module.resultsetMetadata}}
{{else}}
type: array
{{> oneResultetMetadata module.resultsetMetadata.[0]}}
{{/if}}
{{/inline}}

{{#*inline "oneResultetMetadata"}}
items: 
  type: object
  properties:
  {{#each this}}
    {{name}}:
      type: {{type}}
  {{/each}}
{{/inline}}

{{#*inline "multipleResultsetMetadata"}}
properties:
{{#each this}}
  '{{@index}}':
    type: array
    {{> oneResultetMetadata this}}
{{/each}}
{{/inline}}